<div class="sdk-search">

    <div class="row-fluid">
        <div class="span12">
            <label>Samlinger</label>
            <span style="height: 20px; vertical-align: center;" ng-repeat="collection in collections">
                  <input
                    type="checkbox"
                    value="{{collection.id}}"
                    ng-model="collection.selected"
                    ng-change="collectionsChange(collection)"
                    style="width: 20px;"
                  >{{collection.name}}
            </span>
        </div>
    </div>

    <div class="row-fluid" ng-repeat="row in ctrl.queries">

        <div class="span12">
            <div class="row-fluid redform-form sdk-search__config">
                <div class="span4">
                    <div class="field">
                        <label>
                            Felt
                            <select
                                ng-model="row.field"
                                ng-change="ctrl.clearRow(row)"
                                ng-options="field.view_name for field in fields | filter:{searchable:true} | filter:fieldCollectionFilter">
                            </select>
                        </label>
                    </div>
                </div>
                <div class="span4">
                    <div class="field">
                        <label>
                            Operator
                            <select
                                ng-options="operators[operator] as operators[operator].label for operator in types[row.field.type].operators"
                                ng-model="row.operator"
                                ng-change="shouldEscape(row, row.operator)"

                                ng-init="ctrl.clearRow(row)">
                                <option>Vælg</option>
                            </select>
                        </label>
                    </div>
                </div>
                <div class="span4">
                    <div class="field">
                        <term-field type="row.field.type" data="row" submit-func="ctrl.submitSearch(event)"></term-field>
                    </div>
                </div>
                <a href class="sdk-search__remove" title="Fjern række" ng-click="ctrl.removeField($index, $event)" ng-if="ctrl.queries.length > 1">
                    <span class="sdk-icon delete"></span>
                </a>
            </div>
        </div>
    </div>

    <div class="row-fluid">
        <div class="span12">
            <a href class="sdk-search__add" ng-click="ctrl.addField('firstnames')">Tilføj et felt</a>
        </div>
    </div>

    <div class="row-fluid">
        <div class="span12">
            <button type="button" class="button" ng-click="startNewSearch()" ng-disabled="searching">Søg</button>

             <hr class="sdk-search__divider">
        </div>

    </div>

    <section class="row-fluid" ng-if="ctrl.results.docs.length == 0">
        <div class="span12">
            <p>Der er ikke fundet nogen resultater</p>
        </div>
    </section>

    <section class="row-fluid" ng-if="ctrl.error">
        <div class="span12">
            Der skete en uventet fejl, prøv venligst igen.
        </div>
    </section>

    <section class="row-fluid" ng-if="!ctrl.error">

        <div class="span3">

            <h2>Valgte filtre</h2>

            <div>

                <div class="filter-link">
                    <div ng-if="ctrl.noSelectedFilters">
                        Ingen aktive filtre
                    </div>
                    <filter-link ng-repeat="(field, filterQuery) in ctrl.filterQueries" facet="filterQuery.facet" bucket="filterQuery.bucket" url="filter.filterQuery" remove-func="toggleFilter"></filter-link>
                </div>

            </div>


            <facet ng-repeat="facetData in facets" field="fieldIndex[facetData.field]" filter-queries="ctrl.filterQueries" facet="facetData" buckets="ctrl.facetFields[facetData.field].buckets" add-filter="toggleFilter"></facet>

        </div>

        <div class="span9">

            <section class="row-fluid sdk-search__results" ng-class="{'loading': ctrl.searching}" ng-if="ctrl.results.docs.length > 0">
                <div class="span4">
                    <div class="sdk-search__count">
                        <post-count page="page" total="ctrl.results.numFound" posts-pr-page="10"></post-count>
                    </div>
                </div>

                <div class="span8 sorting">
                    <div class="row">
                        <div class="span6 text-right">
                            <label class="sorting__label">Sortér efter</label>
                        </div>

                        <div class="span6">

                            <div class="sorting__container">
                                <select
                                    class="sorting__selection"
                                    ng-model="ctrl.sortField"
                                    ng-options="field as field.view_name for (fieldName, field) in fields | filter:{searchable:true, sortable:true}">
                                </select>
                                <a href ng-click="ctrl.toggleSortDirection()" class="sorting__direction" title="{{ctrl.sortDirection}}" ng-class="ctrl.sortDirection"></a>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="row-fluid">
                    <div class="span12">
                        <div class="search-container">

                            <div class="search-container__row">
                                <div class="search-container__header">
                                    Navn
                                </div>
                                <div class="search-container__header">
                                    Adresse
                                </div>
                                <div class="search-container__header">
                                    Andre oplysninger
                                </div>
                                <div class="search-container__header">
                                    Om kilden
                                </div>
                            </div>

                            <search-result ng-repeat="result in ctrl.results.docs" result="result" config="ctrl.fields" index="$index" page="page"></search-result>

                        </div>
                    </div>
                </div>

            </section>

            <div class="row-fluid" ng-if="ctrl.results.numFound > 10">
                <div class="span12">
                    <pagination current-page="page" results="ctrl.results" go-to-page="ctrl.goToPage"></pagination>
                </div>
            </div>

        </div>

    </section>

</div>
