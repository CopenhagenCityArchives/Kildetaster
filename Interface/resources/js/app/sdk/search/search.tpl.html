<div>
    
    <!-- Search config -->
    <section ng-if="ctrl.results.numFound === undefined">
        
        <div class="row-fluid with-padding">
            <div class="span12">

                <div get-dom-content="search-app-upper-text"></div>
          
                <div class="collection">
                    <div class="collection__item" ng-repeat="collection in ctrl.collections">
                        <input
                            id="col_{{collection.id}}"
                            type="checkbox"
                            value="{{collection.id}}"
                            ng-model="collection.selected"
                            ng-change="ctrl.collectionsChange(collection)">
                            <label for="col_{{collection.id}}">{{collection.name}}</label>
                    </div>
                </div>

                <div get-dom-content="search-app-lower-text"></div>
            </div>
        </div>

        <div class="row-fluid with-padding" ng-repeat="row in ctrl.queries">

            <div class="span12">
                <div class="row-fluid redform-form sdk-search__config">
                    <div class="span4">
                        <div class="field">
                            <label>
                                Felt
                                <select
                                    ng-model="row.field"
                                    ng-change="ctrl.clearRow(row)"
                                    ng-options="field.view_name for field in fields | filter:{searchable:true} | filter:fieldCollectionFilter">
                                </select>
                            </label>
                        </div>
                    </div>
                    <div class="span2">
                        <div class="field">
                            <label>
                                Operator
                                <select
                                    ng-options="operators[operator] as operators[operator].label for operator in types[row.field.type].operators"
                                    ng-model="row.operator"
                                    ng-change="shouldEscape(row, row.operator)">
                                    <option>Vælg</option>
                                </select>
                            </label>
                        </div>
                    </div>
                    <div class="span6">
                        <div class="field">
                            <term-field type="row.field.type" data="row" submit-func="ctrl.submitSearch(event)"></term-field>
                        </div>
                    </div>
                    <a href class="sdk-search__remove" title="Fjern række" ng-click="ctrl.removeField($index, $event)" ng-if="ctrl.queries.length > 1">
                        <span class="sdk-icon delete"></span>
                    </a>
                </div>
            </div>
        </div>

        <div class="row-fluid with-padding">
            <div class="span12">
                <a href class="sdk-search__add" ng-click="ctrl.addField('firstnames')">Tilføj et felt</a>
            </div>
        </div>

        <div class="row-fluid with-padding">
            <div class="span12">
                <button type="button" class="button" ng-click="startNewSearch()" ng-disabled="searching">Søg</button>

                <hr class="sdk-search__divider">
            </div>

        </div>
    </section>

    <!-- Status messages -->
    <section class="row-fluid with-padding" ng-if="ctrl.results.docs.length == 0">
        <div class="span12">
            <p>Der er ikke fundet nogen resultater</p>

            <a href="" ng-click="ctrl.showSearchConfig()" class="sdk-search__configtoggle">Rediger din søgning</a>
        </div>
    </section>

    <section class="row-fluid with-padding" ng-if="ctrl.error">
        <div class="span12">
            Der skete en uventet fejl, prøv venligst igen.
        </div>
    </section>

    <!-- Results -->
    <section ng-if="ctrl.results.docs.length > 0">

        <div class="row-fluid with-padding">

            <div class="span12">
                
                <h1>Søgeresultat</h1>
                <search-config-text class="search-config-text" config="ctrl.queries" collections="ctrl.collections">
                    <post-count page="ctrl.page" total="ctrl.results.numFound" posts-pr-page="ctrl.postsPrPage"></post-count>
                </search-config-text>
            </div>
        </div>

        <div class="row-fluid with-padding">

            <div class="span3">
                <num-pages selected="ctrl.postsPrPage" change-count="ctrl.setPostsPrPage(count)"></num-pages>
            </div>

            <div class="span4">
                <div class="row-fluid sorting">
                    
                    <div class="span6 text-right">
                        <label class="sorting__label">Sortér efter</label>
                    </div>

                    <div class="span6">
                        <div class="sorting__container">
                            <select class="sorting__selection" ng-model="ctrl.sortField" ng-options="field as field.view_name for (fieldName, field) in fields | filter:{searchable:true, sortable:true}"></select>
                            <a href ng-click="ctrl.toggleSortDirection()" class="sorting__direction" title="{{ctrl.sortDirection}}" ng-class="ctrl.sortDirection"></a>
                        </div>
                    </div>

                </div>
            </div>

            <div class="span5" ng-if="ctrl.results.numFound > 10">
                <pagination current-page="ctrl.page" results="ctrl.results" go-to-page="ctrl.goToPage"></pagination>
            </div>
        </div>

        <section class="row-fluid" ng-if="!ctrl.error">

            <div class="span12">
                <div class="span3 sdk-search__col">

                    <a href="" ng-click="ctrl.showSearchConfig()" class="sdk-search__configtoggle">Rediger din søgning</a>
                
                    <h2 class="with-padding">Valgte filtre</h2>
                
                    <div>
                
                        <div class="filter-link">
                            <div ng-if="ctrl.noSelectedFilters">
                                Ingen aktive filtre
                            </div>
                            <filter-link ng-repeat="(field, filterQuery) in ctrl.filterQueries" facet="filterQuery.facet" bucket="filterQuery.bucket"
                                url="filter.filterQuery" remove-func="toggleFilter"></filter-link>
                        </div>
                
                    </div>
                
                    <facet ng-repeat="facetData in facets" field="fieldIndex[facetData.field]" filter-queries="ctrl.filterQueries" facet="facetData"
                        buckets="ctrl.facetFields[facetData.field].buckets" add-filter="toggleFilter"></facet>
                
                </div>

                <div class="span9 sdk-search__col">

                    <section class="row-fluid sdk-search__results" ng-class="{'loading': ctrl.searching}" ng-if="ctrl.results.docs.length > 0">
                
                        <div class="row-fluid">
                            <div class="span12">
                                <div class="search-container">

                                    <div class="search-container__row">
                                        <div>
                                            <div class="search-container__header">
                                                Navn
                                            </div>
                                            <div class="search-container__header">
                                                Adresse
                                            </div>
                                            <div class="search-container__header">
                                                Andre oplysninger
                                            </div>
                                            <div class="search-container__header">
                                                Om kilden
                                            </div>
                                        </div>
                                    </div>

                                    <search-result class="search-container__row" ng-repeat="result in ctrl.results.docs" result="result" config="ctrl.fields" index="$index" page="ctrl.page"></search-result>

                                </div>
                            </div>
                        </div>

                    </section>

                </div>
            </div>

            <section class="row-fluid" ng-if="ctrl.results.numFound > 10">
                <div class="span5">
                    <jump-to-page change-page="ctrl.goToPage(page)"></jump-to-page>
                </div>
                <div class="span7">
                    <pagination current-page="ctrl.page" results="ctrl.results" go-to-page="ctrl.goToPage"></pagination>
                </div>
            </section>

        </section>
    </section>

</div>
