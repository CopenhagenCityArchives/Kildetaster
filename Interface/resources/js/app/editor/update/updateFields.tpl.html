<section class="update-fields">

    <div class="row">
        <div class="col-sm-12">
            <h2>Ret fejl i kilde</h2>
            <p>Herunder er de fejlmeldte indtastninger markeret med gult. Ret fejlene i felterne og klik ”ok”.</p>
        </div>    
        <div class="col-sm-12">
            <h3>Udfyldt</h3>
        
            <ul class="list-unstyled field-list" ng-repeat="(key, value) in values[mainProperty]">

                <li class="field-list__item" ng-if="schema.properties[mainProperty].properties[key].type === 'string' || schema.properties[mainProperty].properties[key].type === 'number' || schema.properties[mainProperty].properties[key].type === 'date'">
                   
                    <a tabindex="1" href ng-click="toggleEditExistingValue(key)">
                        <span class="summary-item">
                            <span class="summary-item__label">{{schema.properties[mainProperty].properties[key].title}}</span>
                            <span class="summary-item__field">{{value}}
                                <span class="icon icon__edit"></span>
                                <span class="glyphicon glyphicon-exclamation-sign icon__error" ng-if="lookupErrorReport(key) !== undefined"></span>
                             </span>
                        </span>
                    </a>

                    <div class="row" ng-if="isEditing(key)">
                    
                        <div class="col-sm-12" ng-if="lookupErrorReport(key) !== undefined">
                            <h2>Fejlmeldingen</h2>
                        </div>

                        <div class="col-sm-12">
                            <form sf-schema="schema" sf-form="[mainProperty + '.' + key]" sf-model="values" sf-options="sfDefaults"></form>
                        </div>  

                        <div class="col-sm-12" ng-if="lookupErrorReport(key) !== undefined">
                            <label>Kommentar</label>
                            <p>{{lookupErrorReport(key).comment}}</p>
                        </div>                  

                        <div class="col-sm-12 text-right">
                            <button tabindex="1" type="button" class="btn btn-default" ng-click="updateField(key)">
                                {{TEXT.BUTTON.OK}}
                            </button>
                        </div>
                    </div>
                </li>
                    

                <li class="field-list__item" ng-if="schema.properties[mainProperty].properties[key].type === 'object'">
                    
                    <span class="summary-item">
                        <span class="summary-item__label">{{schema.properties[mainProperty].properties[key].title}}</span>
                    </span>
                    
                    <span style="display: block" ng-repeat="(subkey, subvalue) in schema.properties[mainProperty].properties[key].properties" ng-if="value[subkey] !== undefined">

                        <a tabindex="1" href ng-click="toggleEditExistingValue(mainProperty + '.' + key + '.' + subkey)">
                            
                            <span class="summary-item">
                                <span class="summary-item__label">{{subvalue.title}}</span>
                                <span class="summary-item__field">{{value[subkey]}}
                                    <span class="icon icon__edit"></span>
                                    <span class="glyphicon glyphicon-exclamation-sign icon__error" ng-if="lookupErrorReport(key, mainProperty, subkey) !== undefined"></span>
                                 </span>
                            </span>
                        </a>

                        <div class="row" ng-if="isEditing(mainProperty + '.' + key + '.' + subkey)">
                            
                            <div class="col-sm-12" ng-if="lookupErrorReport(key, mainProperty, subkey) !== undefined">
                                <h2>Fejlmeldingen</h2>
                            </div>

                            <div class="col-sm-12">                                    
                                <form sf-schema="schema" sf-form="[mainProperty + '.' + key + '.' + subkey]" sf-model="values" sf-options="sfDefaults"></form>
                            </div>  

                            <div class="col-sm-12" ng-if="lookupErrorReport(key, mainProperty, subkey) !== undefined">
                                <label>Kommentar</label>
                                <p>{{lookupErrorReport(key, mainProperty, subkey).comment}}</p>
                            </div>                    

                            <div class="col-sm-12 text-right">
                                <button tabindex="1" type="button" class="btn btn-default" ng-click="updateField(key + '.' + subkey)">
                                    {{TEXT.BUTTON.OK}}
                                </button>
                            </div>
                        </div>

                        <div class="row" ng-if="isEditing(key)">
                    
                            <div class="col-sm-12">
                                <form sf-schema="schema" sf-form="[mainProperty + '.' + key]" sf-model="values"></form>
                            </div>                    

                            <div class="col-sm-12 text-right">
                                <button tabindex="1" type="button" class="btn btn-default" ng-click="updateField(key)">
                                    {{TEXT.BUTTON.OK}}
                                </button>
                            </div>
                        </div>
                    </span>
                </li>

                <li class="field-list__item" ng-if="schema.properties[mainProperty].properties[key].type == 'array'">

                    <span class="summary-item__label">{{schema.properties[mainProperty].properties[key].title}}</span>
                    
                    <ul class="list-unstyled">

                        <li ng-repeat="val in values[mainProperty][key]">   

                            <span ng-repeat="(subkey, value) in val">
                                <a href ng-click="toggleEditExistingValue(subkey, val.id)">
                                    <!-- HARDCODED TEST FOR PERSONS_ID, A FIELD THAT IS ONLY ON TASK 1!! -->
                                    <span ng-if="subkey !== 'id' && subkey !== 'persons_id'">
                                        {{value}}
                                        <span class="icon icon__edit"></span>
                                        <span class="glyphicon glyphicon-exclamation-sign icon__error" ng-if="lookupErrorReport(key, mainProperty, subkey, val.id) !== undefined"></span>
                                    </span>
                                </a>
                                
                                <div class="row" ng-if="isEditing(subkey, val.id)">

                                    <div class="col-sm-12" ng-if="lookupErrorReport(key, mainProperty, subkey, val.id) !== undefined">
                                        <h2>Fejlmeldingen</h2>
                                    </div>

                                    <div class="col-sm-12">
                                        <form ng-init="getSchema(key, subkey);getValue(key, subkey, val.id)" sf-schema="singleSchema" sf-form="['*']" sf-model="singleValue"></form>
                                    </div>

                                    <div class="col-sm-12" ng-if="lookupErrorReport(key, mainProperty, subkey, val.id) !== undefined">
                                        <label>Kommentar</label>
                                        <p>{{lookupErrorReport(key, mainProperty, subkey, val.id).comment}}</p>
                                    </div>   

                                    <div class="col-sm-12 text-right">
                                        <button tabindex="1" type="button" class="btn btn-default" ng-click="updateField(key, subkey)">
                                            {{TEXT.BUTTON.OK}}
                                        </button>
                                    </div>
                                </div>

                            </span>  

                        </li>
                    </ul>
                            
                </li>

            </ul>

        </div>
        
    </div>

</section>